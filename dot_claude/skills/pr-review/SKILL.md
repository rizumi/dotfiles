---
name: pr-review
description: PR番号を指定して複数のレビューエージェントで並列レビューを実行する。PRの変更内容に応じて適切なエージェントを自動選択し、サマリーを標準出力する。「PRをレビューして」「PR #123をチェック」などの要求で使用する。
user-invocable: true
allowed-tools: Read, Grep, Glob, Bash, Task, AskUserQuestion
---

# PR 並列レビュースキル

Pull Requestの変更内容を複数の専門エージェントで並列レビューし、サマリーを出力します。

## 使用方法

```
/pr-review 123        # PR #123 をレビュー
/pr-review            # 最近のPRから選択
```

## 実行手順

### Step 1: PR番号の取得

引数 `$ARGUMENTS` を確認する。

**PR番号が指定されている場合**:
- その番号を使用してレビューを開始

**PR番号が未指定の場合**:
1. `gh pr list --limit 10 --json number,title,author,updatedAt --jq '.[] | "#\(.number) \(.title) by @\(.author.login)"'` で最近のPRを取得
2. `AskUserQuestion` ツールでユーザーに選択させる（options に最大4件のPRを提示）
3. 選択されたPR番号を使用

### Step 2: PR情報の取得

以下のコマンドでPR情報を取得：

```bash
# PRの基本情報
gh pr view $PR_NUMBER --json title,body,additions,deletions,changedFiles

# 変更ファイルリスト
gh pr diff $PR_NUMBER --name-only

# 変更内容（差分）
gh pr diff $PR_NUMBER
```

### Step 3: エージェント選択の判定

PRの変更内容を分析し、以下の基準で使用するエージェントを決定：

| エージェント | 選択基準 |
|-------------|----------|
| **security-reviewer** | 認証・認可、暗号化、API、入力検証、パスワード、トークン、シークレット関連のファイルや変更がある場合 |
| **architecture-reviewer** | 新規ディレクトリ追加、大規模リファクタ（10ファイル以上の変更）、DI設定、サービス・リポジトリ層の変更がある場合 |
| **performance-reviewer** | ループ処理、データ処理、クエリ、キャッシュ、非同期処理、レンダリング関連の変更がある場合 |
| **naming-convention-checker** | 新しいクラス、メソッド、変数の追加がある場合（ほとんどのコード変更で該当） |
| **documentation-reviewer** | `.md` ファイル、ドキュメント、コメントの大幅な変更がある場合 |

**最低1つのエージェントは必ず選択する**（naming-convention-checker をデフォルトとして含める）

### Step 4: 並列レビューの実行

選択したエージェントを `Task` ツールで **並列実行** する。

**重要**: 複数の Task ツール呼び出しを **単一のメッセージで同時に** 発行して並列実行すること。

各エージェントへのプロンプト例：

```
PR #$PR_NUMBER の変更内容をレビューしてください。

## PR情報
タイトル: $TITLE
変更ファイル数: $CHANGED_FILES
追加行: $ADDITIONS / 削除行: $DELETIONS

## 変更ファイル
$FILE_LIST

## 変更差分
$DIFF_CONTENT

インラインコメントは不要です。問題点と改善提案をサマリー形式で出力してください。
```

### Step 5: 結果の統合とサマリー出力

全エージェントの結果を統合し、以下の形式で標準出力する：

```
================================================================================
PR #$PR_NUMBER レビューサマリー
================================================================================

## 概要
- タイトル: $TITLE
- 変更ファイル数: $CHANGED_FILES
- 追加/削除: +$ADDITIONS / -$DELETIONS

## レビュー結果

### セキュリティ (security-reviewer)
[エージェントの出力をまとめる]

### アーキテクチャ (architecture-reviewer)
[エージェントの出力をまとめる]

### パフォーマンス (performance-reviewer)
[エージェントの出力をまとめる]

### 命名規則 (naming-convention-checker)
[エージェントの出力をまとめる]

### ドキュメント (documentation-reviewer)
[エージェントの出力をまとめる]

================================================================================
総合評価
================================================================================
[全体的な所見と優先度の高い改善提案をまとめる]
```

## 制約事項

- **git checkout 禁止**: 並列エージェント実行中のブランチ切り替えは禁止
- **インラインコメント禁止**: GitHub PRへの直接コメントは行わない
- **読み取り専用**: コードの修正は行わない
- PR差分と `gh pr` コマンドでの情報取得のみ使用

---
name: review-changes
description: 現在のgit変更とタスクを把握して全エージェントで並列レビューする
user-invocable: true
allowed-tools: Read, Grep, Glob, Bash, Task, AskUserQuestion
argument-hint: "[base-branch（デフォルト: main）]"
---

# 現在の変更 並列レビュースキル

現在のローカル変更を複数の専門エージェントで並列レビューし、コミット前に問題を検出します。

## 使用方法

```
/review-changes          # main ブランチとの差分をレビュー
/review-changes develop  # develop ブランチとの差分をレビュー
```

## 実行手順

### Step 1: ベースブランチの決定

引数 `$ARGUMENTS` を確認する。

**指定されている場合**: その値をベースブランチとして使用
**未指定の場合**: `main` をデフォルトとして使用

### Step 2: 現在の状況把握

以下のコマンドで変更状況を取得：

```bash
# 変更されたファイルを確認
git status

# 具体的な変更内容（ベースブランチからの差分）
git diff $BASE_BRANCH

# 最近のコミット履歴を確認
git log --oneline -10 $BASE_BRANCH..HEAD
```

### Step 3: エージェント選択の判定

変更内容を分析し、以下の基準で使用するエージェントを決定：

| エージェント | 選択基準 |
|-------------|----------|
| **security-reviewer** | 認証・認可、暗号化、API、入力検証、パスワード、トークン、シークレット関連のファイルや変更がある場合 |
| **architecture-reviewer** | 新規ディレクトリ追加、大規模リファクタ（10ファイル以上の変更）、DI設定、サービス・リポジトリ層の変更がある場合 |
| **performance-reviewer** | ループ処理、データ処理、クエリ、キャッシュ、非同期処理、レンダリング関連の変更がある場合 |
| **naming-convention-checker** | 新しいクラス、メソッド、変数の追加がある場合（ほとんどのコード変更で該当） |
| **documentation-reviewer** | `.md` ファイル、ドキュメント、コメントの大幅な変更がある場合 |

**最低1つのエージェントは必ず選択する**（naming-convention-checker をデフォルトとして含める）

### Step 4: 並列レビューの実行

選択したエージェントを `Task` ツールで **並列実行** する。

**重要**: 複数の Task ツール呼び出しを **単一のメッセージで同時に** 発行して並列実行すること。

各エージェントへのプロンプト例：

```
現在のローカル変更をレビューしてください。

## ベースブランチ
$BASE_BRANCH

## 変更されたファイル
$FILE_LIST

## 変更差分
$DIFF_CONTENT

インラインコメントは不要です。問題点と改善提案をサマリー形式で出力してください。
```

### Step 5: 結果の統合とサマリー出力

全エージェントの結果を統合し、以下の形式で標準出力する：

```
================================================================================
ローカル変更レビューサマリー（ベース: $BASE_BRANCH）
================================================================================

## 概要
- 変更ファイル数: $CHANGED_FILES
- 追加/削除: +$ADDITIONS / -$DELETIONS

## レビュー結果

### セキュリティ (security-reviewer)
[エージェントの出力をまとめる]

### アーキテクチャ (architecture-reviewer)
[エージェントの出力をまとめる]

### パフォーマンス (performance-reviewer)
[エージェントの出力をまとめる]

### 命名規則 (naming-convention-checker)
[エージェントの出力をまとめる]

### ドキュメント (documentation-reviewer)
[エージェントの出力をまとめる]

================================================================================
総合評価
================================================================================
[全体的な所見と優先度の高い改善提案をまとめる]
- コミット前に対処すべき問題を明確化
```

## 制約事項

- **git checkout 禁止**: 並列エージェント実行中のブランチ切り替えは禁止
- **読み取り専用**: コードの修正は行わない
- ローカル差分と `git` コマンドでの情報取得のみ使用
